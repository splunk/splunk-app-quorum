<form theme="dark" version="1.1">
    <label>Besu Ops</label>
    <fieldset submitButton="false">
        <input type="time" searchWhenChanged="true" token="global_time_tok">
            <label>Time Range</label>
            <default>
                <earliest>-1h</earliest>
                <latest>now</latest>
            </default>
        </input>
        <input type="dropdown">
            <label>Time Span</label>
            <choice value="auto">auto</choice>
            <choice value="5s">5s</choice>
            <choice value="10s">10s</choice>
            <choice value="30s">30s</choice>
            <choice value="1m">1m</choice>
            <choice value="5m">5m</choice>
            <choice value="10m">10m</choice>
            <choice value="30m">30m</choice>
            <choice value="1h">1h</choice>
            <default>auto</default>
            <change>
                <eval token="timechart_span">if($value$ == "auto", "", "span=".$value$)</eval>
                <eval token="mstats_span">"span=".$value$</eval>
            </change>
        </input>
    </fieldset>
    <row>
        <panel>
            <html>
                <center>
                    <h1>
                        Besu Metrics
                    </h1>
                </center>
            </html>
        </panel>
    </row>
    <row>
        <panel>
            <single>
                <title>Block Number</title>
                <search>
                    <query>| mstats avg("eth.blockNumber") prestats=true WHERE "index"="metrics" $mstats_span$
                        | timechart avg("eth.blockNumber") AS Avg $timechart_span$
                        | fields - _span*</query>
                    <earliest>$global_time_tok.earliest$</earliest>
                    <latest>$global_time_tok.latest$</latest>
                    <refresh>6s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="colorBy">trend</option>
                <option name="displayview">analytics_workspace</option>
                <option name="drilldown">none</option>
                <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
                <option name="refresh.display">none</option>
                <option name="showTrendIndicator">0</option>
                <option name="trendInterval">-5m</option>
                <option name="useColors">1</option>
            </single>
        </panel>
        <panel>
            <single>
                <title>Hash Rate</title>
                <search>
                    <query>| mstats avg("eth.hashRate") prestats=true WHERE "index"="metrics" $mstats_span$
                        | timechart avg("eth.hashRate") AS Avg $timechart_span$
                        | fields - _span*</query>
                    <earliest>$global_time_tok.earliest$</earliest>
                    <latest>$global_time_tok.latest$</latest>
                    <refresh>1m</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="displayview">analytics_workspace</option>
                <option name="drilldown">none</option>
                <option name="refresh.display">none</option>
            </single>
        </panel>
        <panel>
            <single>
                <title>Peer Count</title>
                <search>
                    <query>| mstats avg("eth.peerCount") prestats=true WHERE "index"="metrics" $mstats_span$
                        | timechart avg("eth.peerCount") AS Avg $timechart_span$
                        | fields - _span*</query>
                    <earliest>$global_time_tok.earliest$</earliest>
                    <latest>$global_time_tok.latest$</latest>
                    <refresh>1m</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="displayview">analytics_workspace</option>
                <option name="drilldown">none</option>
                <option name="refresh.display">none</option>
            </single>
        </panel>
        <panel>
            <single>
                <title>Gas Price</title>
                <search>
                    <query>| mstats avg("eth.gasPrice") prestats=true WHERE "index"="metrics" $mstats_span$
                        | timechart avg("eth.gasPrice") AS Avg $timechart_span$
                        | fields - _span*</query>
                    <earliest>$global_time_tok.earliest$</earliest>
                    <latest>$global_time_tok.latest$</latest>
                    <refresh>1m</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="displayview">analytics_workspace</option>
                <option name="drilldown">none</option>
                <option name="refresh.display">none</option>
            </single>
        </panel>
        <panel>
            <single>
                <title>Transactions</title>
                <search>
                    <query>`eth_txn_logs` sourcetype="ethereum:transaction" status=success
                        | timechart $timechart_span$ fixedrange=t dc(hash) as txns
                        | streamstats sum(txns) as total
                        | fields _time total</query>
                    <earliest>$global_time_tok.earliest$</earliest>
                    <latest>$global_time_tok.latest$</latest>
                    <sampleRatio>1</sampleRatio>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="colorBy">trend</option>
                <option name="drilldown">none</option>
                <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
                <option name="refresh.display">none</option>
                <option name="trellis.enabled">0</option>
                <option name="trellis.scales.shared">1</option>
                <option name="trellis.size">medium</option>
                <option name="useColors">1</option>
            </single>
        </panel>
    </row>
    <row>
        <panel>
            <html>
                <center>
                    <h1>
                        Host Metrics
                    </h1>
                </center>
            </html>
        </panel>
    </row>
    <row>
        <panel>
            <chart>
                <title>CPU (%)</title>
                <search>
                    <query>| mstats avg("system.cpu.load_average.1m") prestats=true WHERE "index"="metrics" $mstats_span$
                        | timechart avg("system.cpu.load_average.1m") AS cpu $timechart_span$
                        | fields - _span*</query>
                    <earliest>$global_time_tok.earliest$</earliest>
                    <latest>$global_time_tok.latest$</latest>
                    <refresh>1m</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="charting.areaFillOpacity">.5</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.axisY.abbreviation">auto</option>
                <option name="charting.chart">area</option>
                <option name="charting.chart.nullValueMode">connect</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.chart.stackMode">default</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.fieldColors">{"Avg":"#1e93c6","system_cpu_procload":"#1e93c6","system_cpu_sysload":"#f2b827","system_cpu_syswait":"#d6563c"}</option>
                <option name="charting.fieldDashStyles">{"Avg":"solid","system_cpu_procload":"solid","system_cpu_sysload":"solid","system_cpu_syswait":"solid"}</option>
                <option name="charting.gridLinesX.showMajorLines">1</option>
                <option name="charting.legend.mode">standard</option>
                <option name="charting.legend.placement">bottom</option>
                <option name="displayview">analytics_workspace</option>
                <option name="height">200</option>
                <option name="refresh.display">none</option>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Memory (GB)</title>
                <search>
                    <query>| mstats avg("system.memory.usage") prestats=true WHERE "index"="metrics" $mstats_span$
                        | timechart avg("system.memory.usage") AS mem $timechart_span$
                        | fields - _span*
                        | eval mem=mem/1000000000</query>
                    <earliest>$global_time_tok.earliest$</earliest>
                    <latest>$global_time_tok.latest$</latest>
                    <sampleRatio>1</sampleRatio>
                    <refresh>1m</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
                <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">visible</option>
                <option name="charting.axisTitleY2.visibility">visible</option>
                <option name="charting.axisX.abbreviation">none</option>
                <option name="charting.axisX.scale">linear</option>
                <option name="charting.axisY.abbreviation">auto</option>
                <option name="charting.axisY.includeZero">1</option>
                <option name="charting.axisY.scale">linear</option>
                <option name="charting.axisY2.abbreviation">none</option>
                <option name="charting.axisY2.enabled">0</option>
                <option name="charting.axisY2.scale">inherit</option>
                <option name="charting.chart">line</option>
                <option name="charting.chart.bubbleMaximumSize">50</option>
                <option name="charting.chart.bubbleMinimumSize">10</option>
                <option name="charting.chart.bubbleSizeBy">area</option>
                <option name="charting.chart.nullValueMode">connect</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
                <option name="charting.chart.stackMode">default</option>
                <option name="charting.chart.style">shiny</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.fieldColors">{"Avg":"#1e93c6","system_memory_allocs":"#1e93c6","system_memory_held":"#f2b827","system_memory_used":"#d6563c"}</option>
                <option name="charting.fieldDashStyles">{"Avg":"Solid","system_memory_allocs":"Solid","system_memory_held":"Solid","system_memory_used":"Solid"}</option>
                <option name="charting.gridLinesX.showMajorLines">1</option>
                <option name="charting.layout.splitSeries">0</option>
                <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
                <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
                <option name="charting.legend.mode">standard</option>
                <option name="charting.legend.placement">bottom</option>
                <option name="charting.lineWidth">2</option>
                <option name="height">200</option>
                <option name="refresh.display">none</option>
                <option name="trellis.enabled">0</option>
                <option name="trellis.scales.shared">1</option>
                <option name="trellis.size">medium</option>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Disk IO Time</title>
                <search>
                    <query>| mstats rate_avg("system.disk.io_time") as "io_time" chart=true WHERE "index"="metrics" $mstats_span$
                        | fields - _span*</query>
                    <earliest>$global_time_tok.earliest$</earliest>
                    <latest>$global_time_tok.latest$</latest>
                    <sampleRatio>1</sampleRatio>
                    <refresh>1m</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
                <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">visible</option>
                <option name="charting.axisTitleY2.visibility">visible</option>
                <option name="charting.axisX.abbreviation">none</option>
                <option name="charting.axisX.scale">linear</option>
                <option name="charting.axisY.abbreviation">auto</option>
                <option name="charting.axisY.includeZero">1</option>
                <option name="charting.axisY.scale">linear</option>
                <option name="charting.axisY2.abbreviation">none</option>
                <option name="charting.axisY2.enabled">0</option>
                <option name="charting.axisY2.scale">inherit</option>
                <option name="charting.chart">line</option>
                <option name="charting.chart.bubbleMaximumSize">50</option>
                <option name="charting.chart.bubbleMinimumSize">10</option>
                <option name="charting.chart.bubbleSizeBy">area</option>
                <option name="charting.chart.nullValueMode">connect</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
                <option name="charting.chart.stackMode">default</option>
                <option name="charting.chart.style">shiny</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.fieldColors">{"Avg":"#1e93c6","Rate (Avg) /s":"#f2b827","Rate (Avg) system_disk_readbytes /s":"#f2b827","Avg system_disk_writebytes":"#d6563c","system_disk_readbytes /s":"#f2b827","system_disk_writebytes /s":"#6a5c9e"}</option>
                <option name="charting.fieldDashStyles">{"Avg":"Solid","Rate (Avg) /s":"Solid","Rate (Avg) system_disk_readbytes /s":"Solid","Avg system_disk_writebytes":"Solid","system_disk_readbytes /s":"Solid","system_disk_writebytes /s":"Solid"}</option>
                <option name="charting.gridLinesX.showMajorLines">1</option>
                <option name="charting.layout.splitSeries">0</option>
                <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
                <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
                <option name="charting.legend.mode">standard</option>
                <option name="charting.legend.placement">bottom</option>
                <option name="charting.lineWidth">2</option>
                <option name="height">200</option>
                <option name="refresh.display">none</option>
                <option name="trellis.enabled">0</option>
                <option name="trellis.scales.shared">1</option>
                <option name="trellis.size">medium</option>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Network Connections</title>
                <search>
                    <query>| mstats avg("system.network.connections") prestats=true WHERE "index"="metrics" $mstats_span$
                        | timechart avg("system.network.connections") AS conn $timechart_span$
                        | fields - _span*</query>
                    <earliest>$global_time_tok.earliest$</earliest>
                    <latest>$global_time_tok.latest$</latest>
                    <sampleRatio>1</sampleRatio>
                    <refresh>1m</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
                <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">visible</option>
                <option name="charting.axisTitleY2.visibility">visible</option>
                <option name="charting.axisX.abbreviation">none</option>
                <option name="charting.axisX.scale">linear</option>
                <option name="charting.axisY.abbreviation">auto</option>
                <option name="charting.axisY.includeZero">1</option>
                <option name="charting.axisY.scale">linear</option>
                <option name="charting.axisY2.abbreviation">none</option>
                <option name="charting.axisY2.enabled">0</option>
                <option name="charting.axisY2.scale">inherit</option>
                <option name="charting.chart">line</option>
                <option name="charting.chart.bubbleMaximumSize">50</option>
                <option name="charting.chart.bubbleMinimumSize">10</option>
                <option name="charting.chart.bubbleSizeBy">area</option>
                <option name="charting.chart.nullValueMode">connect</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
                <option name="charting.chart.stackMode">default</option>
                <option name="charting.chart.style">shiny</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.fieldColors">{"Avg":"#1e93c6","Rate (Avg) /s":"#f2b827","Rate (Avg) system_disk_readbytes /s":"#f2b827","Avg system_disk_writebytes":"#d6563c","system_disk_readbytes /s":"#f2b827","system_disk_writebytes /s":"#6a5c9e"}</option>
                <option name="charting.fieldDashStyles">{"Avg":"Solid","Rate (Avg) /s":"Solid","Rate (Avg) system_disk_readbytes /s":"Solid","Avg system_disk_writebytes":"Solid","system_disk_readbytes /s":"Solid","system_disk_writebytes /s":"Solid"}</option>
                <option name="charting.gridLinesX.showMajorLines">1</option>
                <option name="charting.layout.splitSeries">0</option>
                <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
                <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
                <option name="charting.legend.mode">standard</option>
                <option name="charting.legend.placement">bottom</option>
                <option name="charting.lineWidth">2</option>
                <option name="height">200</option>
                <option name="refresh.display">none</option>
                <option name="trellis.enabled">0</option>
                <option name="trellis.scales.shared">1</option>
                <option name="trellis.size">medium</option>
            </chart>
        </panel>
    </row>
    <row>
        <panel>
            <html>
                <center>
                    <h1>
                        Error Logs
                    </h1>
                </center>
            </html>
        </panel>
    </row>
    <row>
        <panel>
            <chart>
                <title>Errors over time</title>
                <search>
                    <query>index=logs error OR fail* | timechart count</query>
                    <earliest>$global_time_tok.earliest$</earliest>
                    <latest>$global_time_tok.latest$</latest>
                    <sampleRatio>1</sampleRatio>
                    <refresh>5m</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
                <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">visible</option>
                <option name="charting.axisTitleY2.visibility">visible</option>
                <option name="charting.axisX.abbreviation">none</option>
                <option name="charting.axisX.scale">linear</option>
                <option name="charting.axisY.abbreviation">none</option>
                <option name="charting.axisY.scale">linear</option>
                <option name="charting.axisY2.abbreviation">none</option>
                <option name="charting.axisY2.enabled">0</option>
                <option name="charting.axisY2.scale">inherit</option>
                <option name="charting.chart">area</option>
                <option name="charting.chart.bubbleMaximumSize">50</option>
                <option name="charting.chart.bubbleMinimumSize">10</option>
                <option name="charting.chart.bubbleSizeBy">area</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
                <option name="charting.chart.stackMode">default</option>
                <option name="charting.chart.style">shiny</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.layout.splitSeries">0</option>
                <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
                <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
                <option name="charting.legend.mode">standard</option>
                <option name="charting.legend.placement">none</option>
                <option name="charting.lineWidth">2</option>
                <option name="refresh.display">none</option>
                <option name="trellis.enabled">0</option>
                <option name="trellis.scales.shared">1</option>
                <option name="trellis.size">medium</option>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Errors by Besu Logger</title>
                <search>
                    <query>index=logs error OR fail* | top logger</query>
                    <earliest>$global_time_tok.earliest$</earliest>
                    <latest>$global_time_tok.latest$</latest>
                    <sampleRatio>1</sampleRatio>
                    <refresh>5m</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
                <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
                <option name="charting.axisTitleX.visibility">visible</option>
                <option name="charting.axisTitleY.visibility">visible</option>
                <option name="charting.axisTitleY2.visibility">visible</option>
                <option name="charting.axisX.abbreviation">none</option>
                <option name="charting.axisX.scale">linear</option>
                <option name="charting.axisY.abbreviation">none</option>
                <option name="charting.axisY.scale">linear</option>
                <option name="charting.axisY2.abbreviation">none</option>
                <option name="charting.axisY2.enabled">0</option>
                <option name="charting.axisY2.scale">inherit</option>
                <option name="charting.chart">pie</option>
                <option name="charting.chart.bubbleMaximumSize">50</option>
                <option name="charting.chart.bubbleMinimumSize">10</option>
                <option name="charting.chart.bubbleSizeBy">area</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
                <option name="charting.chart.stackMode">default</option>
                <option name="charting.chart.style">shiny</option>
                <option name="charting.drilldown">all</option>
                <option name="charting.layout.splitSeries">0</option>
                <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
                <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
                <option name="charting.legend.mode">standard</option>
                <option name="charting.legend.placement">right</option>
                <option name="charting.lineWidth">2</option>
                <option name="refresh.display">none</option>
                <option name="trellis.enabled">0</option>
                <option name="trellis.scales.shared">1</option>
                <option name="trellis.size">medium</option>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Errors by Besu Exception</title>
                <search>
                    <query>index=logs error OR fail* | top exception</query>
                    <earliest>$global_time_tok.earliest$</earliest>
                    <latest>$global_time_tok.latest$</latest>
                    <sampleRatio>1</sampleRatio>
                    <refresh>5m</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
                <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
                <option name="charting.axisTitleX.visibility">visible</option>
                <option name="charting.axisTitleY.visibility">visible</option>
                <option name="charting.axisTitleY2.visibility">visible</option>
                <option name="charting.axisX.abbreviation">none</option>
                <option name="charting.axisX.scale">linear</option>
                <option name="charting.axisY.abbreviation">none</option>
                <option name="charting.axisY.scale">linear</option>
                <option name="charting.axisY2.abbreviation">none</option>
                <option name="charting.axisY2.enabled">0</option>
                <option name="charting.axisY2.scale">inherit</option>
                <option name="charting.chart">pie</option>
                <option name="charting.chart.bubbleMaximumSize">50</option>
                <option name="charting.chart.bubbleMinimumSize">10</option>
                <option name="charting.chart.bubbleSizeBy">area</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
                <option name="charting.chart.stackMode">default</option>
                <option name="charting.chart.style">shiny</option>
                <option name="charting.drilldown">all</option>
                <option name="charting.layout.splitSeries">0</option>
                <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
                <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
                <option name="charting.legend.mode">standard</option>
                <option name="charting.legend.placement">right</option>
                <option name="charting.lineWidth">2</option>
                <option name="refresh.display">none</option>
                <option name="trellis.enabled">0</option>
                <option name="trellis.scales.shared">1</option>
                <option name="trellis.size">medium</option>
            </chart>
        </panel>
    </row>
    <row>
        <panel>
            <event>
                <title>Latest Error Messages</title>
                <search>
                    <query>index=logs error OR fail* | head 10</query>
                    <earliest>$global_time_tok.earliest$</earliest>
                    <latest>$global_time_tok.latest$</latest>
                    <sampleRatio>1</sampleRatio>
                    <refresh>5m</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="count">5</option>
                <option name="list.drilldown">none</option>
                <option name="list.wrap">1</option>
                <option name="maxLines">5</option>
                <option name="raw.drilldown">none</option>
                <option name="refresh.display">none</option>
                <option name="rowNumbers">0</option>
                <option name="table.drilldown">none</option>
                <option name="table.sortDirection">asc</option>
                <option name="table.wrap">1</option>
                <option name="type">list</option>
            </event>
        </panel>
    </row>
</form>
